{"version":3,"file":"taskdata.min.js","sources":["../../src/taskeditor/taskdata.js"],"sourcesContent":["// This file is part of ProFormA Question Type for Moodle\n//\n// ProFormA Question Type for Moodle is free software:\n// you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// ProFormA Question Type for Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with ProFormA Question Type for Moodle.\n// If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Helper functions for zipping and unzipping task\n *\n * @package    qtype\n * @subpackage proforma\n * @copyright  2023 Ostfalia Hochschule fuer angewandte Wissenschaften\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author     // This file is part of ProFormA Question Type for Moodle\n //\n // ProFormA Question Type for Moodle is free software:\n // you can redistribute it and/or modify\n // it under the terms of the GNU General Public License as published by\n // the Free Software Foundation, either version 3 of the License, or\n // (at your option) any later version.\n //\n // ProFormA Question Type for Moodle is distributed in the hope that it will be useful,\n // but WITHOUT ANY WARRANTY; without even the implied warranty of\n // MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n // GNU General Public License for more details.\n //\n // You should have received a copy of the GNU General Public License\n // along with ProFormA Question Type for Moodle.\n // If not, see <http://www.gnu.org/licenses/>.\n\n /**\n * Helper functions for reading and writen task\n *\n * @package    qtype\n * @subpackage proforma\n * @copyright  2023 Ostfalia Hochschule fuer angewandte Wissenschaften\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author     eCULT-Team of Ostfalia University, K.Borm\n */\n\n\nimport {setErrorMessage, generateUUID} from \"./util\";\nimport * as taskeditorconfig from \"./config\";\nimport {FileStorage, fileStorages } from \"./file\";\n\nexport const T_LMS_USAGE = {\n    DISPLAY: 'display',\n    DOWNLOAD: 'download',\n    EDIT: 'edit'\n};\n\nexport const T_VISIBLE = {\n    YES: 'yes',\n    NO: 'no',\n    DELAYED: 'delayed'\n};\n\nexport const T_FILERESTRICTION_FORMAT = {\n    POSIX: 'posix-ere',\n    NONE: 'none'\n};\n\n\n\n// helper class\nclass XmlReader {\n    constructor(xmlText) {\n        this.xmlDoc = new DOMParser().parseFromString(xmlText,'text/xml');\n        if (!this.xmlDoc.evaluate) {\n            alert('XPATH not supported');\n            return;\n        }\n\n        /*\n        var parser = new DOMParser();\n        [\n            '<task xmlns=\"urn:proforma:v2.0\" lang=\"en\"/>',\n            '<task xmlns=\"urn:proforma:task:v1.0.1\" lang=\"en\" uuid=\"e7a50a36-e0b7-486f-be80-0f217e7bcb80\" xmlns:jartest=\"urn:proforma:tests:jartest:v1\" xmlns:praktomat=\"urn:proforma:praktomat:v0.2\" xmlns:unit=\"urn:proforma:tests:unittest:v1\"/>',\n            '<ns:root xmlns:ns=\"example.com/ns2\"/>'\n        ].forEach(function(item) {\n            var doc = parser.parseFromString(item, \"application/xml\");\n            alert('result of doc.lookupNamespaceURI(null): |' + doc.lookupNamespaceURI(null) + '|');\n        });\n\n*/\n        this.defaultns = this.xmlDoc.lookupNamespaceURI(null);\n        //alert('result of doc.lookupNamespaceURI(null): |' + doc.lookupNamespaceURI(null) + '|');\n\n        this.rootNode = this.xmlDoc;\n\n        const defaultns = this.defaultns;\n        this.nsResolver = function (prefix) {\n\n            switch (prefix) {\n                case 'dns': return defaultns; // 'urn:proforma:task:v1.0.1';\n                default:    return taskeditorconfig.resolveNamespace(prefix, defaultns);\n            }\n        };\n    }\n\n    setRootNode(node) {\n        this.rootNode = node;\n    }\n\n    readSingleNode(xpath, node) {\n        const nodes = this.xmlDoc.evaluate(xpath, node?node:this.rootNode, this.nsResolver,\n            XPathResult.UNORDERED_NODE_ITERATOR_TYPE /*FIRST_ORDERED_NODE_TYPE*/, null);\n        return nodes.iterateNext(); // .singleNodeValue;\n    }\n\n\n    readSingleText(xpath, node, defaultValue) {\n        const nodes = this.xmlDoc.evaluate(xpath, node?node:this.rootNode, this.nsResolver, XPathResult.FIRST_ORDERED_NODE_TYPE, null);\n        if (nodes.singleNodeValue)\n            return nodes.singleNodeValue.textContent.trim();\n        else {\n            if (typeof defaultValue !== 'undefined')\n                return defaultValue;\n            return null;\n        }\n    }\n\n    readNodes(xpath, node) {\n        return this.xmlDoc.evaluate(xpath, node?node:this.rootNode, this.nsResolver, XPathResult.UNORDERED_NODE_ITERATOR_TYPE, null);\n    }\n}\n\n\nclass XmlWriter {\n    constructor(xmlDoc, ns) {\n        this.xmlDoc = xmlDoc;\n        this.ns = ns;\n    }\n\n    createCDataElement(node, tag, value, ns = undefined) {\n        let newTag = this.xmlDoc.createElementNS(ns?ns:this.ns, tag);\n        newTag.appendChild(this.xmlDoc.createCDATASection(value));\n        node.appendChild(newTag);\n        return newTag;\n    }\n\n    createTextElement(node, tag, value, ns = undefined, cdata = false) {\n        let newTag = this.xmlDoc.createElementNS(ns?ns:this.ns, tag);\n        if (cdata) {\n            newTag.appendChild(this.xmlDoc.createCDATASection(value));\n            throw new SyntaxError('cdata not supported, use createCDataElement');\n        }\n        else\n            newTag.appendChild(this.xmlDoc.createTextNode(value));\n        node.appendChild(newTag);\n        return newTag;\n    }\n\n    createOptionalTextElement(node, tag, value, ns = undefined, cdata = false) {\n        if (cdata) {\n            throw new SyntaxError('cdata not supported, use createOptionalTextElement');\n        }\n        if (value === '')\n            return;\n        return this.createTextElement(node, tag, value, ns, cdata);\n    }\n\n    createOptionalCDataElement(node, tag, value, ns = undefined) {\n        if (value === '')\n            return;\n        return this.createCDataElement(node, tag, value, ns);\n    }\n}\n\n// task data structures\nexport class TaskFileRef {\n    constructor(id) {\n        this.refid = id;\n    }\n}\n\nexport class TaskFile {\n    constructor() {\n        this.filename = '';\n        this.usedByGrader = false;\n        this.usageInLms = null;\n        this.visible = T_VISIBLE.NO;\n        this.id = null;\n        this.filetype = null;\n        this.comment = null;\n        this.content = null;\n        this.binary = null;\n    }\n}\n\nexport class TaskFileRestriction {\n    constructor(filename, required, format) {\n        this.restriction = filename;\n        this.required = required;\n        this.format = format;\n    }\n}\n\n\nexport class TaskModelSolution {\n    constructor() {\n        this.id = null;\n        this.description = \"\";\n        this.comment = \"\";\n        this.filerefs = [];\n    }\n}\n\n\nexport class TaskTest {\n    constructor() {\n        this.id = null;\n        this.title = null;\n        this.description = \"\";\n        this.comment = \"\";\n        this.testtype = null;\n        this.filerefs = [];\n        this.writeCallback = null;\n        this.uiElement = null;\n    }\n}\n\nexport class TaskClass {\n\n    constructor() {\n        this.title = '';\n        this.description = '';\n        this.comment = '';\n        this.proglang = '';\n        this.proglangVersion = '';\n        this.parentuuid = null;\n        this.uuid = null;\n        this.lang = 'de';\n        this.sizeSubmission = 0;\n        this.filenameRegExpSubmission = '';\n        this.codeskeleton = '';\n\n        this.fileRestrictions = [];\n        this.files = [];\n        // this.external-resources ;\n        this.modelsolutions = [];\n        this.tests = [];\n        this.gradinghints = [];\n    }\n\n\n    findFilenameForId(id) {\n        let filename = undefined;\n        this.files.forEach(function(item) {\n            if (item.id === id) {\n                filename = item.filename;\n            }\n        });\n        return filename;\n    }\n\n    readTestConfig(xmlfile, testid, configItem, context) {\n        try {\n            let xmlReader = new XmlReader(xmlfile);\n            xmlReader.setRootNode(xmlReader.readSingleNode(\"/dns:task/dns:tests/dns:test[@id=\"+testid+\"]\"));\n            let configNodeNode = xmlReader.readSingleNode(\"dns:test-configuration\");\n            configItem.onReadXml(this.tests[testid], xmlReader, configNodeNode, context);\n        } catch (err){\n            const text = \"Error while parsing test configuration in xml file:\\n\\n\" + err;\n            alert (text);\n            // setErrorMessage(\"Error while parsing test configuration in xml file\", err);\n        }\n    }\n\n    readXmlVersion101(xmlfile) {\n\n        let template_id = null;\n        let template_referenced = false; // is template referenced in test or somewhere else?\n\n\n        function readFileRefs(xmlReader, element, thisNode, visibility, task) {\n            let fileRefIterator = xmlReader.readNodes(\"dns:filerefs/dns:fileref\", thisNode);\n            let fileRefNode = fileRefIterator.iterateNext();\n            let counter = 0;\n            while (fileRefNode) {\n                let fileRef = new TaskFileRef();\n                fileRef.refid = xmlReader.readSingleText(\"@refid\", fileRefNode);\n                if (template_id && (template_id === fileRef.refid)) {\n                    template_referenced = true;\n                }\n                element.filerefs[counter++] = fileRef;\n                fileRefNode = fileRefIterator.iterateNext();\n                if (visibility != null) {\n                    // increase visibilty\n                    switch (task.files[fileRef.refid].visible) {\n                        case T_VISIBLE.NO:  task.files[fileRef.refid].visible = visibility; break;\n                        case T_VISIBLE.YES:  break;\n                        case T_VISIBLE.DELAYED:\n                            if (visibility === T_VISIBLE.YES)\n                                task.files[fileRef.refid].visible = visibility;\n                            break;\n                    }\n                }\n            }\n        }\n\n        try {\n            let xmlReader = new XmlReader(xmlfile);\n            xmlReader.setRootNode(xmlReader.readSingleNode(\"/dns:task\")); // => shorter xpaths\n\n            this.title = xmlReader.readSingleText(\"dns:meta-data/dns:title\");\n            this.description = xmlReader.readSingleText(\"dns:description\");\n            this.proglang = xmlReader.readSingleText(\"dns:proglang\");\n            this.proglangVersion = xmlReader.readSingleText(\"dns:proglang/@version\");\n            this.uuid = xmlReader.readSingleText(\"@uuid\");\n            this.lang = xmlReader.readSingleText(\"@lang\");\n            this.sizeSubmission = xmlReader.readSingleText(\"dns:submission-restrictions/dns:regexp-restriction/@max-size\");\n            if (this.sizeSubmission !== '')\n                this.sizeSubmission = this.sizeSubmission * 1000; // convert to bytes (or *1024?)\n            // mimetype is unsupported\n            // this.mimeTypeRegExpSubmission = xmlReader.readSingleText(\"dns:submission-restrictions/dns:regexp-restriction\");\n\n            // read files\n            let iterator = xmlReader.readNodes(\"dns:files/dns:file\");\n            let thisNode = iterator.iterateNext();\n\n            while (thisNode) {\n                let taskfile = new TaskFile();\n                taskfile.id = xmlReader.readSingleText(\"@id\", thisNode);\n                const fileclass = xmlReader.readSingleText(\"@class\", thisNode);\n                switch(fileclass) {\n                    case 'internal':\n                    case 'internal-library':\n                        taskfile.usedByGrader = true;\n                        taskfile.usageInLms = null;\n                        taskfile.visible = T_VISIBLE.NO;\n                        break;\n                    case 'template':\n                        if (this.codeskeleton === '') {\n                            template_id = taskfile.id;\n                            this.codeskeleton = thisNode.textContent;\n                            taskfile.usedByGrader = false;\n                            taskfile.usageInLms = T_LMS_USAGE.EDIT;\n                            taskfile.visible = T_VISIBLE.YES;\n                        }\n                        else {\n                            taskfile.usedByGrader = false;\n                            //taskfile.usageInLms = T_LMS_USAGE.EDIT;\n                            taskfile.usageInLms = T_LMS_USAGE.DOWNLOAD;\n                            taskfile.visible = T_VISIBLE.YES;\n                        }\n                        break;\n                    case 'instruction':\n                        taskfile.usedByGrader = false;\n                        taskfile.usageInLms = T_LMS_USAGE.DOWNLOAD;\n                        taskfile.visible = T_VISIBLE.YES;\n                        break;\n                    case 'library':\n                        taskfile.usedByGrader = true;\n                        taskfile.usageInLms = T_LMS_USAGE.DOWNLOAD;\n                        taskfile.visible = T_VISIBLE.YES;\n                        break;\n                }\n                taskfile.comment = xmlReader.readSingleText(\"@comment\", thisNode);\n                taskfile.filetype = xmlReader.readSingleText(\"@type\", thisNode);\n                taskfile.filename = xmlReader.readSingleText(\"@filename\", thisNode);\n                taskfile.content = thisNode.textContent;\n                this.files[taskfile.id] = taskfile;\n                thisNode = iterator.iterateNext();\n            }\n\n            // read model solutions(s)\n            iterator = xmlReader.readNodes(\"dns:model-solutions/dns:model-solution\");\n            thisNode = iterator.iterateNext();\n            while (thisNode) {\n                let modelSolution = new TaskModelSolution();\n                modelSolution.id = xmlReader.readSingleText(\"@id\", thisNode);\n                modelSolution.comment = xmlReader.readSingleText(\"@comment\", thisNode);\n                readFileRefs(xmlReader, modelSolution, thisNode, T_VISIBLE.DELAYED, this);\n                this.modelsolutions[modelSolution.id] = modelSolution;\n                thisNode = iterator.iterateNext();\n            }\n\n            // read test(s)\n            iterator = xmlReader.readNodes(\"dns:tests/dns:test\");\n            thisNode = iterator.iterateNext();\n            let counter = 0;\n            while (thisNode) {\n                let test = new TaskTest();\n                test.id = xmlReader.readSingleText(\"@id\", thisNode);\n                test.title = xmlReader.readSingleText(\"dns:title\", thisNode);\n                test.testtype = xmlReader.readSingleText(\"dns:test-type\", thisNode);\n\n                let configIterator = xmlReader.readNodes(\"dns:test-configuration\", thisNode);\n                let configNode = configIterator.iterateNext();\n                readFileRefs(xmlReader, test, configNode);\n\n                this.tests[counter] = test;\n                counter++;\n                thisNode = iterator.iterateNext();\n            }\n\n            // check if template is referenced somewhere. If not then the file can be deleted!\n            if (!template_referenced) {\n                delete this.files[template_id];\n            }\n\n        } catch (err){\n            //alert (err);\n            setErrorMessage(\"Error while parsing the xml file. The file has not been imported.\", err);\n        }\n    }\n\n\n    readXmlVersion2(xmlfile) {\n\n        function readFileRefs(xmlReader, element, thisNode) {\n            let fileRefIterator = xmlReader.readNodes(\"dns:filerefs/dns:fileref\", thisNode);\n            let fileRefNode = fileRefIterator.iterateNext();\n            let counter = 0;\n            while (fileRefNode) {\n                let fileRef = new TaskFileRef();\n                fileRef.refid = xmlReader.readSingleText(\"@refid\", fileRefNode);\n                element.filerefs[counter++] = fileRef;\n                fileRefNode = fileRefIterator.iterateNext();\n            }\n        }\n\n        try {\n            let xmlReader = new XmlReader(xmlfile);\n            xmlReader.setRootNode(xmlReader.readSingleNode(\"/dns:task\")); // => shorter xpaths\n\n            this.title = xmlReader.readSingleText(\"dns:title\");\n            this.description = xmlReader.readSingleText(\"dns:description\");\n            this.comment = xmlReader.readSingleText(\"dns:internal-description\");\n            this.proglang = xmlReader.readSingleText(\"dns:proglang\");\n            this.proglangVersion = xmlReader.readSingleText(\"dns:proglang/@version\");\n            this.uuid = xmlReader.readSingleText(\"@uuid\");\n            this.lang = xmlReader.readSingleText(\"@lang\");\n            this.sizeSubmission = xmlReader.readSingleText(\"dns:submission-restrictions/@max-size\");\n\n            let iterator = xmlReader.readNodes(\"dns:submission-restrictions/dns:file-restriction\");\n            let thisNode = iterator.iterateNext();\n            let editCounter = 0;\n            while (thisNode) {\n                const required =\n                this.fileRestrictions[editCounter++] = new TaskFileRestriction(thisNode.textContent,\n                    xmlReader.readSingleText(\"@required\", thisNode, \"true\")==='true',\n                    xmlReader.readSingleText(\"@pattern-format\", thisNode));\n                thisNode = iterator.iterateNext();\n            }\n\n            // read files\n            iterator = xmlReader.readNodes(\"dns:files/dns:file\");\n            thisNode = iterator.iterateNext();\n            editCounter = 0;\n            while (thisNode) {\n                let taskfile = new TaskFile();\n                taskfile.id = xmlReader.readSingleText(\"@id\", thisNode);\n                //taskfile.fileclass = xmlReader.readSingleText(\"@class\", thisNode);\n                taskfile.usedByGrader = (xmlReader.readSingleText(\"@used-by-grader\", thisNode)==='yes');\n                taskfile.usageInLms = xmlReader.readSingleText(\"@usage-by-lms\", thisNode);\n                taskfile.visible = xmlReader.readSingleText(\"@visible\", thisNode);\n                // todo:\n                taskfile.comment = xmlReader.readSingleText(\"dns:internal-description\", thisNode);\n                let content = xmlReader.readSingleNode('*', thisNode); // nodeValue\n                if (content) {\n                    switch (content.nodeName) {\n                        case \"embedded-txt-file\":\n                            taskfile.filetype = 'embedded';\n                            taskfile.filename = xmlReader.readSingleText(\"@filename\", content);\n                            taskfile.content = content.textContent;\n                            taskfile.binary = false;\n                            break;\n                        case \"embedded-bin-file\":\n                            // taskfile.filetype = 'embedded';\n                            taskfile.filetype = 'file';\n                            taskfile.filename = xmlReader.readSingleText(\"@filename\", content);\n                            taskfile.content = atob(content.textContent);\n                            taskfile.binary = true;\n                            const filecontent =  atob(content.textContent);\n                            console.log(taskfile.id + ' is embedded-bin-file');\n                            console.log(filecontent);\n                            console.log(filecontent.length);\n                            const mimetype = taskeditorconfig.getMimeType('', taskfile.filename); //get mime type\n                            let fileObject = new FileStorage(true, mimetype, filecontent, taskfile.filename);\n                            fileObject.setSize(filecontent.length);\n                            fileStorages[taskfile.id] = fileObject;\n                            break;\n                        case \"attached-bin-file\":\n                            taskfile.filetype = 'file';\n                            taskfile.filename = content.textContent;\n                            taskfile.binary = true;\n                            break;\n                        default:\n                            setErrorMessage(\"Unknown file type for file #\". taskfile.id);\n                    }\n                } else {\n                    setErrorMessage(\"No file content for file #\". taskfile.id);\n                }\n\n                // post processing:\n                // copy file content for editor in associated text area\n                const displaymode = xmlReader.readSingleText(\"@usage-by-lms\", thisNode);\n                if (taskfile.usageInLms === T_LMS_USAGE.EDIT) {\n                    if (editCounter === 0) {\n                        // do not store as file\n                        this.codeskeleton = taskfile.content;\n                    } else {\n                        this.files[taskfile.id] = taskfile;\n                    }\n                    editCounter++;\n                } else {\n                    this.files[taskfile.id] = taskfile;\n                }\n\n\n/*\n                let embeddedTextFile = xmlReader.readSingleNode(\"embedded-txt-file\");\n                if (embeddedTextFile) {\n                    taskfile.filetype = 'embedded';\n                    taskfile.filename = xmlReader.readSingleText(\"@filename\", embeddedTextFile);\n                    taskfile.content = embeddedTextFile.textContent;\n                } else {\n                    let attachedBinFile = xmlReader.readSingleNode(\"attached-bin-file\");\n                    if (attachedBinFile) {\n                        taskfile.filetype = 'file';\n                        taskfile.filename = xmlReader.readSingleText(\"@filename\", attachedBinFile);\n                    } else {\n                        setErrorMessage(\"Unknown file type for file #\". taskfile.id);\n                    }\n                }\n*/\n\n\n\n                thisNode = iterator.iterateNext();\n            }\n\n            // read model solutions(s)\n            iterator = xmlReader.readNodes(\"dns:model-solutions/dns:model-solution\");\n            thisNode = iterator.iterateNext();\n            while (thisNode) {\n                let modelSolution = new TaskModelSolution();\n                modelSolution.id = xmlReader.readSingleText(\"@id\", thisNode);\n                modelSolution.description = xmlReader.readSingleText(\"dns:description\", thisNode);\n                modelSolution.comment = xmlReader.readSingleText(\"dns:internal-description\", thisNode);\n                readFileRefs(xmlReader, modelSolution, thisNode);\n                this.modelsolutions[modelSolution.id] = modelSolution;\n                thisNode = iterator.iterateNext();\n            }\n\n            // read test(s)\n            iterator = xmlReader.readNodes(\"dns:tests/dns:test\");\n            thisNode = iterator.iterateNext();\n            let counter = 0;\n            while (thisNode) {\n                let test = new TaskTest();\n                test.id = xmlReader.readSingleText(\"@id\", thisNode);\n                test.title = xmlReader.readSingleText(\"dns:title\", thisNode);\n                test.description = xmlReader.readSingleText(\"dns:description\", thisNode);\n                test.comment = xmlReader.readSingleText(\"dns:internal-description\", thisNode);\n                test.testtype = xmlReader.readSingleText(\"dns:test-type\", thisNode);\n\n                let configIterator = xmlReader.readNodes(\"dns:test-configuration\", thisNode);\n                let configNode = configIterator.iterateNext();\n                readFileRefs(xmlReader, test, configNode);\n\n                this.tests[counter] = test;\n                counter++;\n                thisNode = iterator.iterateNext();\n            }\n\n            // read grading hints\n            const gradingfunction = xmlReader.readSingleText(\"dns:grading-hints/dns:root/@function\");\n            if (gradingfunction && gradingfunction !== 'sum') {\n                setErrorMessage(\"Grading hints function \" + gradingfunction + \" is not supported\");\n            }\n            iterator = xmlReader.readNodes(\"dns:grading-hints/dns:root/dns:test-ref\");\n            thisNode = iterator.iterateNext();\n            while (thisNode) {\n                const id = xmlReader.readSingleText(\"@ref\", thisNode);\n                this.tests.forEach(function(test) {\n                    if (test.id === id)\n                        test.weight = xmlReader.readSingleText(\"@weight\", thisNode);\n                });\n                thisNode = iterator.iterateNext();\n            }\n\n       } catch (err){\n           //alert (err);\n           setErrorMessage(\"Error while parsing the xml file. The file has not been imported.\", err);\n       }\n    }\n\n    readXml(xmlfile) {\n        let xmlReader = new XmlReader(xmlfile);\n        switch (xmlReader.defaultns) {\n            case 'urn:proforma:task:v1.0.1': return this.readXmlVersion101(xmlfile);\n            case 'urn:proforma:v2.0': return this.readXmlVersion2(xmlfile);\n            default:\n                setErrorMessage(\"Unsupported ProFormA version \" + xmlReader.defaultns);\n        }\n    }\n\n\n    // todo: read data directly from user input instead of using TaskClass object\n    writeXml(topLevelDoc, rootNode) {\n        console.log('*** TaskClass.writeXml');\n\n        let xmlDoc = null;\n        let files = null;\n        let fileRestrictions = null;\n        let modelsolutions = null;\n        let tests = null;\n        let gradingRoot = null;\n        let xmlWriter = null;\n        const xmlns = \"urn:proforma:v2.0\";\n        let task = null;\n\n        /* Version 1.0.1\n        function writeFile(item, index) {\n            let fileElem = xmlDoc.createElementNS(xmlns, \"file\");\n            fileElem.setAttribute(\"class\", item.fileclass);\n            fileElem.setAttribute(\"comment\", item.comment);\n            fileElem.setAttribute(\"filename\", item.filename);\n            fileElem.setAttribute(\"id\", item.id);\n            fileElem.setAttribute(\"type\", item.filetype);\n            files.appendChild(fileElem);\n            if (item.filetype === 'embedded')\n                fileElem.appendChild(xmlDoc.createCDATASection(item.content));\n        }\n        */\n\n        // version 2.0\n\n        function writeCodeSkeleton(task, id) {\n            if (task.codeskeleton) {\n                let fileElem = xmlDoc.createElementNS(xmlns, \"file\");\n                fileElem.setAttribute(\"id\", id);\n                fileElem.setAttribute(\"used-by-grader\", 'false');\n                fileElem.setAttribute(\"usage-by-lms\", T_LMS_USAGE.EDIT);\n                fileElem.setAttribute(\"visible\", T_VISIBLE.YES);\n\n                // fileElem.setAttribute(\"comment\", item.comment);\n                files.appendChild(fileElem);\n                let fileContentElem = xmlDoc.createElementNS(xmlns, \"embedded-txt-file\");\n                fileContentElem.setAttribute(\"filename\", 'code.txt');\n                fileContentElem.appendChild(xmlDoc.createCDATASection(task.codeskeleton));\n                fileElem.appendChild(fileContentElem);\n                xmlWriter.createOptionalTextElement(fileElem, 'internal-description', 'Code Skeleton for Editor');\n            }\n        }\n\n        function writeFile(item, index) {\n            let fileElem = xmlDoc.createElementNS(xmlns, \"file\");\n            fileElem.setAttribute(\"id\", item.id);\n            //fileElem.setAttribute(\"class\", item.fileclass);\n            fileElem.setAttribute(\"used-by-grader\", item.usedByGrader);\n            if (item.usageInLms) // optional\n                fileElem.setAttribute(\"usage-by-lms\", item.usageInLms);\n            fileElem.setAttribute(\"visible\", item.visible);\n\n            // fileElem.setAttribute(\"comment\", item.comment);\n            files.appendChild(fileElem);\n            if (item.filetype === 'embedded') {\n                let fileContentElem = xmlDoc.createElementNS(xmlns, \"embedded-txt-file\");\n                fileContentElem.setAttribute(\"filename\", item.filename);\n                fileContentElem.appendChild(xmlDoc.createCDATASection(item.content));\n                fileElem.appendChild(fileContentElem);\n            } else {\n                xmlWriter.createTextElement(fileElem, 'attached-bin-file', item.filename);\n            }\n            xmlWriter.createOptionalTextElement(fileElem, 'internal-description', item.comment);\n        }\n\n        function writeModelSolution(item, index) {\n            function writeFileref(file, index) {\n                if (file.refid) {\n                    let fileref = xmlDoc.createElementNS(xmlns, \"fileref\");\n                    fileref.setAttribute(\"refid\", file.refid);\n                    filerefs.appendChild(fileref);\n                }\n            }\n            let msElem = xmlDoc.createElementNS(xmlns, \"model-solution\");\n            // msElem.setAttribute(\"description\", item.comment); // alt\n            msElem.setAttribute(\"id\", item.id);\n            modelsolutions.appendChild(msElem);\n            let filerefs = xmlDoc.createElementNS(xmlns, \"filerefs\");\n            msElem.appendChild(filerefs);\n            item.filerefs.forEach(writeFileref);\n            // remove filerefs is no fileref available\n            let childs = filerefs.getElementsByTagName('fileref');\n            if (childs.length === 0) {\n                msElem.removeChild(filerefs);\n            }\n            xmlWriter.createOptionalTextElement(msElem, 'description', item.description);\n            xmlWriter.createOptionalTextElement(msElem, 'internal-description', item.comment);\n        }\n\n        function writeTest(item, index) {\n            console.log('*** TaskClass.writeTest');\n            console.log(item);\n            function writeFileref(file, index) {\n                if (file.refid) {\n                    let fileref = xmlDoc.createElementNS(xmlns, \"fileref\");\n                    fileref.setAttribute(\"refid\", file.refid);\n                    filerefs.appendChild(fileref);\n                }\n            }\n            //console.log('writeXml: create ' + item.title);\n\n            let testElem = xmlDoc.createElementNS(xmlns, \"test\");\n            testElem.setAttribute(\"id\", item.id);\n            xmlWriter.createTextElement(testElem, 'title', item.title);\n            xmlWriter.createOptionalTextElement(testElem, 'description', item.description);\n            xmlWriter.createOptionalTextElement(testElem, 'internal-description', item.comment);\n            xmlWriter.createTextElement(testElem, 'test-type', item.testtype);\n            let config = xmlDoc.createElementNS(xmlns, \"test-configuration\");\n            testElem.appendChild(config);\n            let filerefs = xmlDoc.createElementNS(xmlns, \"filerefs\");\n            config.appendChild(filerefs);\n            item.filerefs.forEach(writeFileref);\n            // remove filerefs is no fileref available\n            let childs = filerefs.getElementsByTagName('fileref');\n            if (childs.length === 0) {\n                config.removeChild(filerefs);\n            }\n\n            tests.appendChild(testElem);\n            if (item.configItem) {\n                console.log('*** item.configItem.onWriteXml');\n\n                // alert('config write xml');\n                item.configItem.onWriteXml(item, config, xmlDoc, xmlWriter, task);\n            }\n        }\n\n        function writeGradingTest(item, index) {\n            let testElem = xmlDoc.createElementNS(xmlns, \"test-ref\");\n            testElem.setAttribute(\"weight\", item.weight);\n            testElem.setAttribute(\"ref\", item.id);\n            gradingRoot.appendChild(testElem);\n        }\n\n        function writeFileRestriction(item, index) {\n            //let regexp = xmlWriter.createTextElement(submission, \"regexp-restriction\", this.filenameRegExpSubmission);\n            //submission.appendChild(regexp);\n            // regexp.setAttribute(\"mime-type-regexp\", this.mimeTypeRegExpSubmission);\n\n\n            let fileElem = //xmlDoc.createElementNS(xmlns, \"file-restriction\");\n            xmlWriter.createOptionalTextElement(fileRestrictions, 'file-restriction', item.restriction, xmlns);\n            if (!item.required) // optional, defaults to true\n                fileElem.setAttribute(\"required\", item.required);\n\n            if (item.format) // optional, defaults to none\n                fileElem.setAttribute(\"pattern-format\", item.format);\n\n            //fileRestrictions.appendChild(fileElem);\n        }\n\n\n        try {\n\n            if (topLevelDoc) {\n                xmlDoc = topLevelDoc;\n                task = xmlDoc.createElementNS(xmlns, \"task\");\n                rootNode.appendChild(task);\n            }\n            else {\n                xmlDoc = document.implementation.createDocument(xmlns, \"task\", null);\n                task = xmlDoc.documentElement;\n            }\n\n            task.setAttribute(\"lang\", this.lang);\n            task.setAttribute(\"uuid\", this.uuid);\n            // task.setAttribute(\"uuid\", generateUUID());// this.uuid);\n            //taskeditorconfig.writeNamespaces(task);\n\n            xmlWriter = new XmlWriter(xmlDoc, xmlns);\n\n            xmlWriter.createTextElement(task, 'title', this.title);\n            xmlWriter.createCDataElement(task, 'description', this.description);\n            xmlWriter.createOptionalCDataElement(task, 'internal-description', this.comment);\n            let proglang = xmlWriter.createTextElement(task, 'proglang', this.proglang);\n            proglang.setAttribute(\"version\", this.proglangVersion);\n\n            fileRestrictions = xmlDoc.createElementNS(xmlns, \"submission-restrictions\");\n            if (this.sizeSubmission)\n                fileRestrictions.setAttribute(\"max-size\", this.sizeSubmission);\n            task.appendChild(fileRestrictions);\n            this.fileRestrictions.forEach(writeFileRestriction);\n\n            files = xmlDoc.createElementNS(xmlns, \"files\");\n            task.appendChild(files);\n            writeCodeSkeleton(this, 'codeskeleton');\n            this.files.forEach(writeFile);\n\n            modelsolutions = xmlDoc.createElementNS(xmlns, \"model-solutions\");\n            task.appendChild(modelsolutions);\n            this.modelsolutions.forEach(writeModelSolution);\n\n            tests = xmlDoc.createElementNS(xmlns, \"tests\");\n            task.appendChild(tests);\n            const length = this.tests.length;\n            this.tests.forEach(writeTest);\n\n            // grading-hints\n            let gradinghints = xmlDoc.createElementNS(xmlns, \"grading-hints\");\n            task.appendChild(gradinghints);\n            gradingRoot = xmlDoc.createElementNS(xmlns, \"root\");\n            gradingRoot.setAttribute(\"function\", \"sum\");\n            gradinghints.appendChild(gradingRoot);\n            this.tests.forEach(writeGradingTest);\n\n            let metadata = xmlDoc.createElementNS(xmlns, \"meta-data\");\n            task.appendChild(metadata);\n///            taskeditorconfig.writeXmlExtra(metadata, xmlDoc, xmlWriter);\n            //xmlWriter.createTextElement(metadata, 'praktomat:allowed-upload-filename-mimetypes', '(text/.*)');\n\n            let serializer = new XMLSerializer();\n            let result = serializer.serializeToString (xmlDoc);\n\n            if ((result.substring(0, 5) !== \"<?xml\")){\n                result = '<?xml version=\"1.0\"?>' + result;\n                // result = \"<?xml version='1.0' encoding='UTF-8'?>\" + result;\n            }\n\n            let xsds = [ 'xsd/proforma.xsd' ];\n            // do not add all xsds from configuration because not all of them may be used\n            // resulting in an error message\n            xsds = xsds.concat(taskeditorconfig.xsds);\n\n/*\n            if (!topLevelDoc) { // do not validate for XML part\n                // validate output\n                xsds.forEach(function (xsd_file, index) {\n                    $.get(xsd_file, function (data, textStatus, jqXHR) {      // read XSD schema\n                        const valid = xmllint.validateXML({xml: result, schema: jqXHR.responseText});\n                        if (valid.errors !== null) {                                // does not conform to schema\n                            //alert(xsd_file);\n                            setErrorMessage(\"Errors in XSD-Validation \" + xsd_file + \":\");\n                            valid.errors.some(function (error, index) {\n                                setErrorMessage(error);\n                                return index > 15;\n                            })\n                        }\n                    }).fail(function (jqXHR, textStatus, errorThrown) {\n                        setErrorMessage(\"XSD-Schema \" + xsd_file + \" not found.\", errorThrown);\n                    });\n                });\n            }\n*/\n            return result;\n        } catch (err){\n            setErrorMessage(\"Error creating task xml file.\", err);\n            return '';\n        }\n    }\n}"],"names":["T_LMS_USAGE","DISPLAY","DOWNLOAD","EDIT","T_VISIBLE","YES","NO","DELAYED","POSIX","NONE","XmlReader","constructor","xmlText","xmlDoc","DOMParser","parseFromString","this","evaluate","alert","defaultns","lookupNamespaceURI","rootNode","nsResolver","prefix","taskeditorconfig","resolveNamespace","setRootNode","node","readSingleNode","xpath","XPathResult","UNORDERED_NODE_ITERATOR_TYPE","iterateNext","readSingleText","defaultValue","nodes","FIRST_ORDERED_NODE_TYPE","singleNodeValue","textContent","trim","readNodes","XmlWriter","ns","createCDataElement","tag","value","undefined","newTag","createElementNS","appendChild","createCDATASection","createTextElement","cdata","SyntaxError","createTextNode","createOptionalTextElement","createOptionalCDataElement","TaskFileRef","id","refid","TaskFile","filename","usedByGrader","usageInLms","visible","filetype","comment","content","binary","TaskFileRestriction","required","format","restriction","TaskModelSolution","description","filerefs","TaskTest","title","testtype","writeCallback","uiElement","proglang","proglangVersion","parentuuid","uuid","lang","sizeSubmission","filenameRegExpSubmission","codeskeleton","fileRestrictions","files","modelsolutions","tests","gradinghints","findFilenameForId","forEach","item","readTestConfig","xmlfile","testid","configItem","context","xmlReader","configNodeNode","onReadXml","err","readXmlVersion101","template_id","template_referenced","readFileRefs","element","thisNode","visibility","task","fileRefIterator","fileRefNode","counter","fileRef","iterator","taskfile","modelSolution","test","configIterator","readXmlVersion2","editCounter","nodeName","atob","filecontent","console","log","length","mimetype","getMimeType","fileObject","FileStorage","setSize","configNode","gradingfunction","weight","readXml","writeXml","topLevelDoc","gradingRoot","xmlWriter","xmlns","document","implementation","createDocument","documentElement","setAttribute","index","fileElem","fileContentElem","writeCodeSkeleton","msElem","file","fileref","getElementsByTagName","removeChild","testElem","config","onWriteXml","metadata","result","XMLSerializer","serializeToString","substring","xsds","concat"],"mappings":"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"}