{"version":3,"file":"dynamic-list.min.js","sources":["../../src/taskeditor/dynamic-list.js"],"sourcesContent":["// This file is part of ProFormA Question Type for Moodle\n//\n// ProFormA Question Type for Moodle is free software:\n// you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// ProFormA Question Type for Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with ProFormA Question Type for Moodle.\n// If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Helper functions for zipping and unzipping task\n *\n * @package    qtype\n * @subpackage proforma\n * @copyright  2023 Ostfalia Hochschule fuer angewandte Wissenschaften\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author     // This file is part of ProFormA Question Type for Moodle\n //\n // ProFormA Question Type for Moodle is free software:\n // you can redistribute it and/or modify\n // it under the terms of the GNU General Public License as published by\n // the Free Software Foundation, either version 3 of the License, or\n // (at your option) any later version.\n //\n // ProFormA Question Type for Moodle is distributed in the hope that it will be useful,\n // but WITHOUT ANY WARRANTY; without even the implied warranty of\n // MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n // GNU General Public License for more details.\n //\n // You should have received a copy of the GNU General Public License\n // along with ProFormA Question Type for Moodle.\n // If not, see <http://www.gnu.org/licenses/>.\n\n /**\n * Class for extendable list\n *\n * @package    qtype\n * @subpackage proforma\n * @copyright  2023 Ostfalia Hochschule fuer angewandte Wissenschaften\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author     eCULT-Team of Ostfalia University, K.Borm\n */\n\n// todo: replace table solution with something without table!\n\nimport $ from 'jquery';\nimport Templates from 'core/templates';\n\n// abstract class for a filename reference input\nexport class DynamicList {\n\n    constructor(classFilename, css_classname, jsClassName, label, help, mandatory, extra_css_class) {\n        this.classFilename = 'xml_fileref_filename';\n        this.classAddItem = 'add_fileref';\n        this.classRemoveItem = 'remove_item';\n        this.help = help;\n        this.createTableString(jsClassName, mandatory);\n        this.rowTemplateHtml = null;\n    }\n\n    getClassFilename() { return this.classFilename; }\n\n    createRowFromTemplate() {\n        if (this.rowTemplateHtml) {\n            return Promise.resolve(this.rowTemplateHtml);\n        }\n\n        let context = {\n            'filenamelabel' : '???'\n        };\n        return Templates.renderForPromise('qtype_proforma/taskeditor_fileref_row', context)\n            .then(({html, js}) => {\n                this.rowTemplateHtml = html;\n                return html;\n            });\n    }\n\n    createTableString(className, mandatory) {\n        this.className = className;\n        this.mandatory = mandatory;\n    }\n\n    addItem(element) {\n        // add new line at the end\n        // let td = element.parent();\n        // let tr = td.parent();\n        let table_body = element.closest('tbody'); // tr.parent();\n        let label = table_body.find(\"label\").first().html();\n        let newRow = document.createElement('tr');\n        table_body.append(newRow);\n        element.hide(); // hide current +-button\n        return this.createRowFromTemplate()\n            .then(html => {\n                newRow.innerHTML = html;\n                $(newRow).find(\"label\").first().hide();\n                $(newRow).find(\"label\").first().html(label);\n                table_body.find(\".\" + this.classRemoveItem).show(); // show all remove file buttons\n                table_body.find(\".\" + this.classAddItem).hide(); // show all remove file buttons\n                $(newRow).find(\".\" + this.classAddItem).show();\n                return $(newRow);\n            });\n    }\n\n    // virtual\n    getPreviousItem(tr) {\n        return tr.prev(\"tr\");\n    }\n\n    // virtual\n    getItemCount(table_body) {\n        return table_body.find(\"tr\").length;\n    }\n\n    removeItem(element) {\n        let td = element.parent();\n        let tr = td.parent();\n\n        // remove line in file table for test\n        let table_body = tr.closest('tbody');\n\n\n        let previousRow = this.getPreviousItem(tr); // tr.prev(\"tr\");\n        let hasNextTr = tr.nextAll(\"tr\");\n        let hasPrevTr = tr.prevAll(\"tr\");\n\n        tr.remove(); // remove row\n\n        if (hasNextTr.length === 0) {\n            // if row to be deleted is last row then add +-button to last row\n            //let tds = previousRow.find(\"td\");\n            //let td = tds.last();\n            // $(this.tdAddButton).insertBefore(previousRow.find(\"td\").last());\n            console.log('row to be deleted is last row then add +-button to last row');\n\n            previousRow.find(\".\" + this.classAddItem).show();\n        }\n        if (hasPrevTr.length === 0) {\n            // row to be deleted is first row\n            // => add filename label to first column\n            console.log('row to be deleted is first row => add filename label to first column');\n            table_body.find(\"label\").first().show();\n            // let firstCell = table_body.find(\"td\").first();\n            // firstCell.append(this.label); // without td\n        }\n\n        // check if previousRow is first row\n        let firstRow = table_body.find(\"tr\")[0];\n        if (this.getItemCount(table_body) === 1) {\n            // table has exactly one row left\n            // => hide all remove file buttons\n            console.log('table has exactly one row left => hide all remove file buttons');\n            table_body.find(\".\" + this.classRemoveItem).hide();\n        }\n    }\n}\n\n\n\n"],"names":["constructor","classFilename","css_classname","jsClassName","label","help","mandatory","extra_css_class","classAddItem","classRemoveItem","createTableString","rowTemplateHtml","getClassFilename","this","createRowFromTemplate","Promise","resolve","Templates","renderForPromise","then","_ref","html","js","className","addItem","element","table_body","closest","find","first","newRow","document","createElement","append","hide","innerHTML","show","getPreviousItem","tr","prev","getItemCount","length","removeItem","parent","previousRow","hasNextTr","nextAll","hasPrevTr","prevAll","remove","console","log"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;0MA2DIA,YAAYC,cAAeC,cAAeC,YAAaC,MAAOC,KAAMC,UAAWC,sBACtEN,cAAgB,4BAChBO,aAAe,mBACfC,gBAAkB,mBAClBJ,KAAOA,UACPK,kBAAkBP,YAAaG,gBAC/BK,gBAAkB,KAG3BC,0BAA4BC,KAAKZ,cAEjCa,2BACQD,KAAKF,uBACEI,QAAQC,QAAQH,KAAKF,wBAMzBM,mBAAUC,iBAAiB,wCAHpB,eACQ,QAGjBC,MAAKC,WAACC,KAACA,KAADC,GAAOA,qBACLX,gBAAkBU,KAChBA,IAAP,IAIZX,kBAAkBa,UAAWjB,gBACpBiB,UAAYA,eACZjB,UAAYA,UAGrBkB,QAAQC,aAIAC,WAAaD,QAAQE,QAAQ,SAC7BvB,MAAQsB,WAAWE,KAAK,SAASC,QAAQR,OACzCS,OAASC,SAASC,cAAc,aACpCN,WAAWO,OAAOH,QAClBL,QAAQS,OACDrB,KAAKC,wBACPK,MAAKE,OACFS,OAAOK,UAAYd,yBACjBS,QAAQF,KAAK,SAASC,QAAQK,2BAC9BJ,QAAQF,KAAK,SAASC,QAAQR,KAAKjB,OACrCsB,WAAWE,KAAK,IAAMf,KAAKJ,iBAAiB2B,OAC5CV,WAAWE,KAAK,IAAMf,KAAKL,cAAc0B,2BACvCJ,QAAQF,KAAK,IAAMf,KAAKL,cAAc4B,QACjC,mBAAEN,WAKrBO,gBAAgBC,WACLA,GAAGC,KAAK,MAInBC,aAAad,mBACFA,WAAWE,KAAK,MAAMa,OAGjCC,WAAWjB,aAEHa,GADKb,QAAQkB,SACLA,SAGRjB,WAAaY,GAAGX,QAAQ,SAGxBiB,YAAc/B,KAAKwB,gBAAgBC,IACnCO,UAAYP,GAAGQ,QAAQ,MACvBC,UAAYT,GAAGU,QAAQ,MAE3BV,GAAGW,SAEsB,IAArBJ,UAAUJ,SAKVS,QAAQC,IAAI,+DAEZP,YAAYhB,KAAK,IAAMf,KAAKL,cAAc4B,QAErB,IAArBW,UAAUN,SAGVS,QAAQC,IAAI,wEACZzB,WAAWE,KAAK,SAASC,QAAQO,QAMtBV,WAAWE,KAAK,MAAM,GACC,IAAlCf,KAAK2B,aAAad,cAGlBwB,QAAQC,IAAI,kEACZzB,WAAWE,KAAK,IAAMf,KAAKJ,iBAAiByB"}