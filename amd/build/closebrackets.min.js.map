{"version":3,"sources":["../src/closebrackets.js"],"names":["mod","exports","module","require","define","amd","CodeMirror","defaults","pairs","closeBefore","triples","explode","Pos","defineOption","cm","val","old","Init","removeKeyMap","keyMap","state","closeBrackets","ensureBound","getOption","addKeyMap","conf","name","Backspace","getConfig","Pass","ranges","listSelections","i","length","empty","around","charsAround","head","indexOf","cur","replaceRange","line","ch","Enter","operation","linesep","lineSeparator","replaceSelection","execCommand","indentLine","chars","charAt","key","handler","handleChar","deflt","override","mode","getModeAt","getCursor","contractSelection","sel","inverted","cmpPos","anchor","pos","identical","opening","type","range","curType","next","getRange","stringStartsAfter","test","getTokenTypeAt","prev","isWordChar","left","right","sels","getSelections","replaceSelections","slice","setSelections","triggerElectric","str","token","getTokenAt","start"],"mappings":"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","sourcesContent":["// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: https://codemirror.net/LICENSE\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"qtype_proforma/codemirror\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"qtype_proforma/codemirror\"], mod);\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n  var defaults = {\n    pairs: \"()[]{}''\\\"\\\"\",\n    closeBefore: \")]}'\\\":;>\",\n    triples: \"\",\n    explode: \"[]{}\"\n  };\n\n  var Pos = CodeMirror.Pos;\n\n  CodeMirror.defineOption(\"autoCloseBrackets\", false, function(cm, val, old) {\n    if (old && old != CodeMirror.Init) {\n      cm.removeKeyMap(keyMap);\n      cm.state.closeBrackets = null;\n    }\n    if (val) {\n      ensureBound(getOption(val, \"pairs\"))\n      cm.state.closeBrackets = val;\n      cm.addKeyMap(keyMap);\n    }\n  });\n\n  function getOption(conf, name) {\n    if (name == \"pairs\" && typeof conf == \"string\") return conf;\n    if (typeof conf == \"object\" && conf[name] != null) return conf[name];\n    return defaults[name];\n  }\n\n  var keyMap = {Backspace: handleBackspace, Enter: handleEnter};\n  function ensureBound(chars) {\n    for (var i = 0; i < chars.length; i++) {\n      var ch = chars.charAt(i), key = \"'\" + ch + \"'\"\n      if (!keyMap[key]) keyMap[key] = handler(ch)\n    }\n  }\n  ensureBound(defaults.pairs + \"`\")\n\n  function handler(ch) {\n    return function(cm) { return handleChar(cm, ch); };\n  }\n\n  function getConfig(cm) {\n    var deflt = cm.state.closeBrackets;\n    if (!deflt || deflt.override) return deflt;\n    var mode = cm.getModeAt(cm.getCursor());\n    return mode.closeBrackets || deflt;\n  }\n\n  function handleBackspace(cm) {\n    var conf = getConfig(cm);\n    if (!conf || cm.getOption(\"disableInput\")) return CodeMirror.Pass;\n\n    var pairs = getOption(conf, \"pairs\");\n    var ranges = cm.listSelections();\n    for (var i = 0; i < ranges.length; i++) {\n      if (!ranges[i].empty()) return CodeMirror.Pass;\n      var around = charsAround(cm, ranges[i].head);\n      if (!around || pairs.indexOf(around) % 2 != 0) return CodeMirror.Pass;\n    }\n    for (var i = ranges.length - 1; i >= 0; i--) {\n      var cur = ranges[i].head;\n      cm.replaceRange(\"\", Pos(cur.line, cur.ch - 1), Pos(cur.line, cur.ch + 1), \"+delete\");\n    }\n  }\n\n  function handleEnter(cm) {\n    var conf = getConfig(cm);\n    var explode = conf && getOption(conf, \"explode\");\n    if (!explode || cm.getOption(\"disableInput\")) return CodeMirror.Pass;\n\n    var ranges = cm.listSelections();\n    for (var i = 0; i < ranges.length; i++) {\n      if (!ranges[i].empty()) return CodeMirror.Pass;\n      var around = charsAround(cm, ranges[i].head);\n      if (!around || explode.indexOf(around) % 2 != 0) return CodeMirror.Pass;\n    }\n    cm.operation(function() {\n      var linesep = cm.lineSeparator() || \"\\n\";\n      cm.replaceSelection(linesep + linesep, null);\n      cm.execCommand(\"goCharLeft\");\n      ranges = cm.listSelections();\n      for (var i = 0; i < ranges.length; i++) {\n        var line = ranges[i].head.line;\n        cm.indentLine(line, null, true);\n        cm.indentLine(line + 1, null, true);\n      }\n    });\n  }\n\n  function contractSelection(sel) {\n    var inverted = CodeMirror.cmpPos(sel.anchor, sel.head) > 0;\n    return {anchor: new Pos(sel.anchor.line, sel.anchor.ch + (inverted ? -1 : 1)),\n            head: new Pos(sel.head.line, sel.head.ch + (inverted ? 1 : -1))};\n  }\n\n  function handleChar(cm, ch) {\n    var conf = getConfig(cm);\n    if (!conf || cm.getOption(\"disableInput\")) return CodeMirror.Pass;\n\n    var pairs = getOption(conf, \"pairs\");\n    var pos = pairs.indexOf(ch);\n    if (pos == -1) return CodeMirror.Pass;\n\n    var closeBefore = getOption(conf,\"closeBefore\");\n\n    var triples = getOption(conf, \"triples\");\n\n    var identical = pairs.charAt(pos + 1) == ch;\n    var ranges = cm.listSelections();\n    var opening = pos % 2 == 0;\n\n    var type;\n    for (var i = 0; i < ranges.length; i++) {\n      var range = ranges[i], cur = range.head, curType;\n      var next = cm.getRange(cur, Pos(cur.line, cur.ch + 1));\n      if (opening && !range.empty()) {\n        curType = \"surround\";\n      } else if ((identical || !opening) && next == ch) {\n        if (identical && stringStartsAfter(cm, cur))\n          curType = \"both\";\n        else if (triples.indexOf(ch) >= 0 && cm.getRange(cur, Pos(cur.line, cur.ch + 3)) == ch + ch + ch)\n          curType = \"skipThree\";\n        else\n          curType = \"skip\";\n      } else if (identical && cur.ch > 1 && triples.indexOf(ch) >= 0 &&\n                 cm.getRange(Pos(cur.line, cur.ch - 2), cur) == ch + ch) {\n        if (cur.ch > 2 && /\\bstring/.test(cm.getTokenTypeAt(Pos(cur.line, cur.ch - 2)))) return CodeMirror.Pass;\n        curType = \"addFour\";\n      } else if (identical) {\n        var prev = cur.ch == 0 ? \" \" : cm.getRange(Pos(cur.line, cur.ch - 1), cur)\n        if (!CodeMirror.isWordChar(next) && prev != ch && !CodeMirror.isWordChar(prev)) curType = \"both\";\n        else return CodeMirror.Pass;\n      } else if (opening && (next.length === 0 || /\\s/.test(next) || closeBefore.indexOf(next) > -1)) {\n        curType = \"both\";\n      } else {\n        return CodeMirror.Pass;\n      }\n      if (!type) type = curType;\n      else if (type != curType) return CodeMirror.Pass;\n    }\n\n    var left = pos % 2 ? pairs.charAt(pos - 1) : ch;\n    var right = pos % 2 ? ch : pairs.charAt(pos + 1);\n    cm.operation(function() {\n      if (type == \"skip\") {\n        cm.execCommand(\"goCharRight\");\n      } else if (type == \"skipThree\") {\n        for (var i = 0; i < 3; i++)\n          cm.execCommand(\"goCharRight\");\n      } else if (type == \"surround\") {\n        var sels = cm.getSelections();\n        for (var i = 0; i < sels.length; i++)\n          sels[i] = left + sels[i] + right;\n        cm.replaceSelections(sels, \"around\");\n        sels = cm.listSelections().slice();\n        for (var i = 0; i < sels.length; i++)\n          sels[i] = contractSelection(sels[i]);\n        cm.setSelections(sels);\n      } else if (type == \"both\") {\n        cm.replaceSelection(left + right, null);\n        cm.triggerElectric(left + right);\n        cm.execCommand(\"goCharLeft\");\n      } else if (type == \"addFour\") {\n        cm.replaceSelection(left + left + left + left, \"before\");\n        cm.execCommand(\"goCharRight\");\n      }\n    });\n  }\n\n  function charsAround(cm, pos) {\n    var str = cm.getRange(Pos(pos.line, pos.ch - 1),\n                          Pos(pos.line, pos.ch + 1));\n    return str.length == 2 ? str : null;\n  }\n\n  function stringStartsAfter(cm, pos) {\n    var token = cm.getTokenAt(Pos(pos.line, pos.ch + 1))\n    return /\\bstring/.test(token.type) && token.start == pos.ch &&\n      (pos.ch == 0 || !/\\bstring/.test(cm.getTokenTypeAt(pos)))\n  }\n});\n"],"file":"closebrackets.min.js"}