define ("qtype_proforma/inlinemessages",["exports","./codemirror"],function(a,b){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.embedError=void 0;b=function(a){return a&&a.__esModule?a:{default:a}}(b);function c(a){if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(a=d(a))){var b=0,c=function(){};return{s:c,n:function n(){if(b>=a.length)return{done:!0};return{done:!1,value:a[b++]}},e:function e(a){throw a},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var e,f=!0,g=!1,h;return{s:function s(){e=a[Symbol.iterator]()},n:function n(){var a=e.next();f=a.done;return a},e:function e(a){g=!0;h=a},f:function f(){try{if(!f&&null!=e.return)e.return()}finally{if(g)throw h}}}}function d(a,b){if(!a)return;if("string"==typeof a)return e(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return e(a,b)}function e(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}function f(a){for(var b=0;b<a.length;++b){a[b].clear()}a.length=0;return a}function g(a,b,c){c=f(c);for(var k=0,i;k<b.length;++k){i=b[k];if(!i){continue}var d=document.createElement("div"),e;switch(i.msgtype.toLowerCase()){case"error":e=d.appendChild(document.createElement("span"));e.innerHTML="x";e.className="proforma-dot-icon proforma-error-icon";d.className="proforma-inline-error";break;case"warn":case"warning":e=d.appendChild(document.createElement("span"));e.className="proforma-warn-icon proforma-warning";d.className="proforma-inline-warning";break;case"info":e=d.appendChild(document.createElement("span"));e.innerHTML="i";e.className="proforma-dot-icon proforma-info-icon";d.className="proforma-inline-info";break;default:e=d.appendChild(document.createElement("span"));e.innerHTML="?";e.className="proforma-dot-icon proforma-else-icon";d.className="proforma-inline-info";console.error("do not know message type "+i.msgtype);break;}d.appendChild(document.createTextNode(" "+i.text));var g=a.addLineWidget(i.line-1,d,{coverGutter:!0,noHScroll:!0});c.push(g)}var h=a.getScrollInfo(),j=a.charCoords({line:a.getCursor().line+1,ch:0},"local").top;if(h.top+h.clientHeight<j){a.scrollTo(null,j-h.clientHeight+3)}return c}function h(a){var b=a;if("string"==typeof b){b=document.querySelector(b)}if(null===b||!b.tagName===void 0){throw new Error("Element "+a+" does not reference a CodeMirror instance.")}if("TEXTAREA"===b.tagName){return b.nextSibling.CodeMirror}console.error("could not find Codemirror editor for "+a);return null}function i(a,b){var d=[],e=document.getElementById(a),f=e.querySelectorAll(".proforma_testlog"),g="",h=c(f),i;try{for(h.s();!(i=h.n()).done;){var t=i.value;if(0==t.innerText.length){g=g+"\n"+t.textContent}else{g=g+"\n"+t.innerText}}}catch(a){h.e(a)}finally{h.f()}var j=new RegExp(b,"mg"),k=g.matchAll(j),l=c(k),m;try{for(l.s();!(m=l.n()).done;){var n=m.value,o=n.groups,p=o.msgtype,q=o.filename,r=o.line,s=o.text;d.push({line:r,text:s,msgtype:p})}}catch(a){l.e(a)}finally{l.f()}return d}function j(a){var b=0,c=0,d=0,e=0;if(a){for(var f=0,g;f<a.length;++f){g=a[f];if(!g){continue}switch(g.msgtype.toLowerCase()){case"error":b++;break;case"warn":case"warning":c++;break;case"info":d++;break;default:console.error("do not know message type "+g.msgtype);e++;break;}}}return[b,c,d,e]}var l=function(a){return new Promise(function(b){var c=function(){var d=document.getElementById(a);if(d){b(d)}window.requestAnimationFrame(c)};c()})},m=function(a,b){return new Promise(function(c){var d=function(){var e=a.querySelector(b);if(e){c(e)}window.requestAnimationFrame(d)};d()})};function k(a,b,c){var d=[];a=CSS.escape(a);l(b).then(function(a){console.log("collapse ready");return m(a,"a")}).then(function(e){console.log("a ready");var k=i(b,c);if(0==k.length){console.log("no messages found => ready");return}var l=j(k),m=l[0],n=l[1],o=l[2],p=l[3],q=" ";if(0<m){q+=m+"<span class=\"proforma-dot-icon proforma-error-icon\">x</span> "}if(0<n){q+=n+"<span class=\"proforma-warn-icon proforma-warning\"/></span> "}if(0<o){q+=o+"<span class=\"proforma-dot-icon proforma-info-icon\">i</span> "}if(0<p){q+=p+"<span class=\"proforma-dot-icon proforma-else-icon\">?</span> "}var r=document.createElement("button");r.type="button";r.className="proforma-feedback-msg-btn";r.innerHTML=q;var s=!1;e.insertAdjacentElement("afterend",r);r.addEventListener("click",function(){var b=h("#"+a);if(!s){d=g(b,k,d);r.className="proforma-feedback-msg-btn active";s=!0}else{d=f(d);r.className="proforma-feedback-msg-btn";s=!1}})}).catch(function(a){console.error(a)})}a.embedError=function embedError(a,b,c){if(!a){console.error("cmid is invalid");return}if("loading"!==document.readyState){k(a,b,c)}else{document.addEventListener("DOMContentLoaded",function(){k(a,b,c)})}}});
//# sourceMappingURL=inlinemessages.min.js.map
