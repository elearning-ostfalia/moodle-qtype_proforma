define ("qtype_proforma/inlinemessages",["exports","./codemirror"],function(a,b){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.embedError=void 0;b=function(a){return a&&a.__esModule?a:{default:a}}(b);function c(a,b){return f(a)||e(a,b)||d()}function d(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function e(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=!0){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=!0;f=a}finally{try{if(!d&&null!=g["return"])g["return"]()}finally{if(e)throw f}}return c}function f(a){if(Array.isArray(a))return a}function g(a){for(var b=0;b<a.length;++b){a[b].clear()}a.length=0;return a}function h(a,b,c){c=g(c);for(var k=0,i;k<b.length;++k){i=b[k];if(!i){continue}var d=document.createElement("div"),e;switch(i.msgtype.toLowerCase()){case"error":e=d.appendChild(document.createElement("span"));e.innerHTML="x";e.className="proforma-dot-icon proforma-error-icon";d.className="proforma-inline-error";break;case"warn":case"warning":e=d.appendChild(document.createElement("span"));e.className="proforma-warn-icon proforma-warning";d.className="proforma-inline-warning";break;case"info":e=d.appendChild(document.createElement("span"));e.innerHTML="i";e.className="proforma-dot-icon proforma-info-icon";d.className="proforma-inline-info";break;default:e=d.appendChild(document.createElement("span"));e.innerHTML="?";e.className="proforma-dot-icon proforma-else-icon";d.className="proforma-inline-info";console.error("do not know message type "+i.msgtype);break;}d.appendChild(document.createTextNode(" "+i.text));var f=a.addLineWidget(i.line-1,d,{coverGutter:!0,noHScroll:!0});c.push(f)}var h=a.getScrollInfo(),j=a.charCoords({line:a.getCursor().line+1,ch:0},"local").top;if(h.top+h.clientHeight<j){a.scrollTo(null,j-h.clientHeight+3)}return c}function i(a){var b=a;if("string"==typeof b){b=document.querySelector(b)}if(null===b||!b.tagName===void 0){throw new Error("Element "+a+" does not reference a CodeMirror instance.")}if("TEXTAREA"===b.tagName){return b.nextSibling.CodeMirror}console.error("could not find Codemirror editor for "+a);return null}function j(a,b){var c=document.getElementById(a),d=c.querySelectorAll(".proforma_testlog"),e="",f=!0,g=!1,h=void 0;try{for(var i=d[Symbol.iterator](),j,k;!(f=(j=i.next()).done);f=!0){k=j.value;if(0==k.innerText.length){e=e+"\n"+k.textContent}else{e=e+"\n"+k.innerText}}}catch(a){g=!0;h=a}finally{try{if(!f&&null!=i.return){i.return()}}finally{if(g){throw h}}}var l=new RegExp(b,"mg"),m=e.matchAll(l),n=[],o=!0,p=!1,q=void 0;try{for(var r=m[Symbol.iterator](),s;!(o=(s=r.next()).done);o=!0){var t=s.value,u=t.groups,v=u.msgtype,w=u.filename,x=u.line,y=u.text;n.push({line:x,text:y,msgtype:v})}}catch(a){p=!0;q=a}finally{try{if(!o&&null!=r.return){r.return()}}finally{if(p){throw q}}}return n}function k(a){for(var b=0,c=0,d=0,e=0,f=0,g;f<a.length;++f){g=a[f];if(!g){continue}switch(g.msgtype.toLowerCase()){case"error":b++;break;case"warn":case"warning":c++;break;case"info":d++;break;default:console.error("do not know message type "+g.msgtype);e++;break;}}return[b,c,d,e]}function l(a,b,d){var e=[];a=CSS.escape(a);var f=document.getElementById(b);if(!f){console.error("region "+b+" not found");return}var l=j(b,d);if(0==l.length){return}var m=k(l),n=c(m,4),o=n[0],p=n[1],q=n[2],r=n[3],s=" ";if(0<o){s+=o+"<span class=\"proforma-dot-icon proforma-error-icon\">x</span> "}if(0<p){s+=p+"<span class=\"proforma-warn-icon proforma-warning\"/></span> "}if(0<q){s+=q+"<span class=\"proforma-dot-icon proforma-info-icon\">i</span> "}if(0<r){s+=r+"<span class=\"proforma-dot-icon proforma-else-icon\">?</span> "}var t=document.createElement("button");t.type="button";t.className="proforma-feedback-msg-btn";t.innerHTML=s;var u=!1,v=f.querySelector("a");v.insertAdjacentElement("afterend",t);t.addEventListener("click",function(){var b=i("#"+a);if(!u){e=h(b,l,e);t.className="proforma-feedback-msg-btn active";u=!0}else{e=g(e);t.className="proforma-feedback-msg-btn";u=!1}})}a.embedError=function embedError(a,b,c){if(!a){console.error("cmid is invalid");return}if("loading"!==document.readyState){l(a,b,c)}else{document.addEventListener("DOMContentLoaded",function(){l(a,b,c)})}}});
//# sourceMappingURL=inlinemessages.min.js.map
