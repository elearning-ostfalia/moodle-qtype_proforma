define ("qtype_proforma/inlinemessages",["exports"],function(a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.embedError=void 0;function b(a){if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(a=c(a))){var b=0,d=function(){};return{s:d,n:function n(){if(b>=a.length)return{done:!0};return{done:!1,value:a[b++]}},e:function e(a){throw a},f:d}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var e,f=!0,g=!1,h;return{s:function s(){e=a[Symbol.iterator]()},n:function n(){var a=e.next();f=a.done;return a},e:function e(a){g=!0;h=a},f:function f(){try{if(!f&&null!=e.return)e.return()}finally{if(g)throw h}}}}function c(a,b){if(!a)return;if("string"==typeof a)return d(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return d(a,b)}function d(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}function e(a){for(var b=0;b<a.length;++b){a[b].clear()}a.length=0;return a}function f(a,b,c){c=e(c);for(var k=0,i;k<b.length;++k){i=b[k];if(!i){continue}var d=document.createElement("div"),f;if(i.msgtype!==void 0){switch(i.msgtype.toLowerCase()){case"error":f=d.appendChild(document.createElement("span"));f.innerHTML="x";f.className="proforma-dot-icon proforma-error-icon";d.className="proforma-inline-error";break;case"warn":case"warning":f=d.appendChild(document.createElement("span"));f.className="proforma-warn-icon proforma-warning";d.className="proforma-inline-warning";break;case"info":f=d.appendChild(document.createElement("span"));f.innerHTML="i";f.className="proforma-dot-icon proforma-info-icon";d.className="proforma-inline-info";break;default:f=d.appendChild(document.createElement("span"));f.innerHTML="?";f.className="proforma-dot-icon proforma-else-icon";d.className="proforma-inline-info";console.error("do not know message type "+i.msgtype);break;}}else{f=d.appendChild(document.createElement("span"));f.innerHTML="x";f.className="proforma-dot-icon proforma-error-icon";d.className="proforma-inline-error"}d.appendChild(document.createTextNode(" "+i.text));var g=a.addLineWidget(i.line-1,d,{coverGutter:!0,noHScroll:!0});c.push(g)}var h=a.getScrollInfo(),j=a.charCoords({line:a.getCursor().line+1,ch:0},"local").top;if(h.top+h.clientHeight<j){a.scrollTo(null,j-h.clientHeight+3)}return c}function g(a){var b=a;if("string"==typeof b){b=document.querySelector(b)}if(null===b||!b.tagName===void 0){throw new Error("Element "+a+" does not reference a CodeMirror instance.")}if("TEXTAREA"===b.tagName){return b.nextSibling.CodeMirror}console.error("could not find Codemirror editor for "+a);return null}function h(a,c,d){var e=[],f=document.getElementById(a),g=f.querySelectorAll(".proforma_testlog"),h="",i=new RegExp(c,"mg"),j=b(g),k;try{for(j.s();!(k=j.n()).done;){var l=k.value,m=void 0;if(0===l.innerText.length){m=l.textContent}else{m=l.innerText}if(m.match(i)){h=0<h.length?h+"\n"+m:m}}}catch(a){j.e(a)}finally{j.f()}var n=h.matchAll(i),o=b(n),p;try{for(o.s();!(p=o.n()).done;){var q=p.value,r=q.groups,s=r.msgtype,t=r.filename,u=r.line,v=r.text,w=r.symbol;if(t!==void 0&&d!=void 0){if(0!==d.localeCompare(t)){continue}}var x={line:u,text:v,msgtype:s};if(w!==void 0){x.text=x.text+" '"+w.trim()+"'"}e.push(x)}}catch(a){o.e(a)}finally{o.f()}return e}function i(a){var b=0,c=0,d=0,e=0;if(a){for(var f=0,g;f<a.length;++f){g=a[f];if(!g){continue}if("undefined"!=typeof g.msgtype){switch(g.msgtype.toLowerCase()){case"error":b++;break;case"warn":case"warning":c++;break;case"info":d++;break;default:console.error("do not know message type "+g.msgtype);e++;break;}}else{b++}}}return[b,c,d,e]}var k=function(a){return new Promise(function(b){var c=function(){var d=document.getElementById(a);if(d){b(d)}window.requestAnimationFrame(c)};c()})},l=function(a,b){return new Promise(function(c){var d=function(){var e=a.querySelector(b);if(e){c(e)}window.requestAnimationFrame(d)};d()})};function j(a,b,c,d){var j=[];a=CSS.escape(a);k(b).then(function(a){return l(a,"a")}).then(function(k){var l=h(b,c,d);if(0==l.length){return}var m=i(l),n=m[0],o=m[1],p=m[2],q=m[3],r=" ";if(0<n){r+=n+"<span class=\"proforma-dot-icon proforma-error-icon\">x</span> "}if(0<o){r+=o+"<span class=\"proforma-warn-icon proforma-warning\"/></span> "}if(0<p){r+=p+"<span class=\"proforma-dot-icon proforma-info-icon\">i</span> "}if(0<q){r+=q+"<span class=\"proforma-dot-icon proforma-else-icon\">?</span> "}var s=document.createElement("button");s.type="button";s.className="proforma-feedback-msg-btn";s.innerHTML=r;k.insertAdjacentElement("afterend",s);var t=!1;s.addEventListener("click",function(){var b=g("#"+a);if(!t){j=f(b,l,j);s.className="proforma-feedback-msg-btn active";t=!0}else{j=e(j);s.className="proforma-feedback-msg-btn";t=!1}})}).catch(function(a){console.error(a)})}a.embedError=function embedError(a,b,c,d){if(!a){console.error("cmid is invalid");return}if("loading"!==document.readyState){j(a,b,c,d)}else{document.addEventListener("DOMContentLoaded",function(){j(a,b,c,d)})}}});
//# sourceMappingURL=inlinemessages.min.js.map
