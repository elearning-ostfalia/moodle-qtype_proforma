{"version":3,"sources":["../src/active-line.js"],"names":["mod","exports","module","require","define","amd","CodeMirror","BACK_CLASS","GUTT_CLASS","defineOption","cm","val","old","prev","Init","off","selectionChange","clearActiveLines","state","activeLines","updateActiveLines","listSelections","on","i","length","removeLineClass","sameArray","a","b","ranges","active","range","option","getOption","nonEmpty","anchor","line","head","empty","getLineHandleVisualStart","push","operation","addLineClass","sel"],"mappings":"mSAGA,CAAC,SAASA,CAAT,CAAc,CACb,GAAsB,QAAlB,sBAAOC,CAAAA,OAAP,qBAAOA,OAAP,IAA+C,QAAjB,sBAAOC,CAAAA,MAAP,qBAAOA,MAAP,EAAlC,CACEF,CAAG,CAACG,OAAO,CAAC,2BAAD,CAAR,CAAH,CADF,IAEK,IAAqB,UAAjB,QAAOC,CAAAA,MAAP,EAA+BA,MAAM,CAACC,GAA1C,CACHD,OAAM,8BAAC,CAAC,2BAAD,CAAD,CAAgCJ,CAAhC,CAAN,CADG,IAGHA,CAAAA,CAAG,CAACM,UAAD,CACN,CAPD,EAOG,SAASA,CAAT,CAAqB,CACtB,aADsB,GAGlBC,CAAAA,CAAU,CAAG,kCAHK,CAIlBC,CAAU,CAAG,8BAJK,CAMtBF,CAAU,CAACG,YAAX,CAAwB,iBAAxB,IAAkD,SAASC,CAAT,CAAaC,CAAb,CAAkBC,CAAlB,CAAuB,CACvE,GAAIC,CAAAA,CAAI,CAAGD,CAAG,EAAIN,CAAU,CAACQ,IAAlB,IAAiCF,CAA5C,CACA,GAAID,CAAG,EAAIE,CAAX,CAAiB,OACjB,GAAIA,CAAJ,CAAU,CACRH,CAAE,CAACK,GAAH,CAAO,uBAAP,CAAgCC,CAAhC,EACAC,CAAgB,CAACP,CAAD,CAAhB,CACA,MAAOA,CAAAA,CAAE,CAACQ,KAAH,CAASC,WACjB,CACD,GAAIR,CAAJ,CAAS,CACPD,CAAE,CAACQ,KAAH,CAASC,WAAT,CAAuB,EAAvB,CACAC,CAAiB,CAACV,CAAD,CAAKA,CAAE,CAACW,cAAH,EAAL,CAAjB,CACAX,CAAE,CAACY,EAAH,CAAM,uBAAN,CAA+BN,CAA/B,CACD,CACF,CAbD,EAeA,QAASC,CAAAA,CAAT,CAA0BP,CAA1B,CAA8B,CAC5B,IAAK,GAAIa,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGb,CAAE,CAACQ,KAAH,CAASC,WAAT,CAAqBK,MAAzC,CAAiDD,CAAC,EAAlD,CAAsD,CACpDb,CAAE,CAACe,eAAH,CAAmBf,CAAE,CAACQ,KAAH,CAASC,WAAT,CAAqBI,CAArB,CAAnB,CAA4C,MAA5C,0BACAb,CAAE,CAACe,eAAH,CAAmBf,CAAE,CAACQ,KAAH,CAASC,WAAT,CAAqBI,CAArB,CAAnB,CAA4C,YAA5C,CAA0DhB,CAA1D,EACAG,CAAE,CAACe,eAAH,CAAmBf,CAAE,CAACQ,KAAH,CAASC,WAAT,CAAqBI,CAArB,CAAnB,CAA4C,QAA5C,CAAsDf,CAAtD,CACD,CACF,CAED,QAASkB,CAAAA,CAAT,CAAmBC,CAAnB,CAAsBC,CAAtB,CAAyB,CACvB,GAAID,CAAC,CAACH,MAAF,EAAYI,CAAC,CAACJ,MAAlB,CAA0B,SAC1B,IAAK,GAAID,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGI,CAAC,CAACH,MAAtB,CAA8BD,CAAC,EAA/B,EACE,GAAII,CAAC,CAACJ,CAAD,CAAD,EAAQK,CAAC,CAACL,CAAD,CAAb,CAAkB,QADpB,CAEA,QACD,CAED,QAASH,CAAAA,CAAT,CAA2BV,CAA3B,CAA+BmB,CAA/B,CAAuC,CAErC,OADIC,CAAAA,CAAM,CAAG,EACb,CAASP,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGM,CAAM,CAACL,MAA3B,CAAmCD,CAAC,EAApC,CAAwC,IAClCQ,CAAAA,CAAK,CAAGF,CAAM,CAACN,CAAD,CADoB,CAElCS,CAAM,CAAGtB,CAAE,CAACuB,SAAH,CAAa,iBAAb,CAFyB,CAGtC,GAAqB,QAAjB,UAAOD,CAAP,GAA6BA,CAAM,CAACE,QAApC,CAA+CH,CAAK,CAACI,MAAN,CAAaC,IAAb,EAAqBL,CAAK,CAACM,IAAN,CAAWD,IAA/E,CAAsF,CAACL,CAAK,CAACO,KAAN,EAA3F,CACE,SACF,GAAIF,CAAAA,CAAI,CAAG1B,CAAE,CAAC6B,wBAAH,CAA4BR,CAAK,CAACM,IAAN,CAAWD,IAAvC,CAAX,CACA,GAAIN,CAAM,CAACA,CAAM,CAACN,MAAP,CAAgB,CAAjB,CAAN,EAA6BY,CAAjC,CAAuCN,CAAM,CAACU,IAAP,CAAYJ,CAAZ,CACxC,CACD,GAAIV,CAAS,CAAChB,CAAE,CAACQ,KAAH,CAASC,WAAV,CAAuBW,CAAvB,CAAb,CAA6C,OAC7CpB,CAAE,CAAC+B,SAAH,CAAa,UAAW,CACtBxB,CAAgB,CAACP,CAAD,CAAhB,CACA,IAAK,GAAIa,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGO,CAAM,CAACN,MAA3B,CAAmCD,CAAC,EAApC,CAAwC,CACtCb,CAAE,CAACgC,YAAH,CAAgBZ,CAAM,CAACP,CAAD,CAAtB,CAA2B,MAA3B,0BACAb,CAAE,CAACgC,YAAH,CAAgBZ,CAAM,CAACP,CAAD,CAAtB,CAA2B,YAA3B,CAAyChB,CAAzC,EACAG,CAAE,CAACgC,YAAH,CAAgBZ,CAAM,CAACP,CAAD,CAAtB,CAA2B,QAA3B,CAAqCf,CAArC,CACD,CACDE,CAAE,CAACQ,KAAH,CAASC,WAAT,CAAuBW,CACxB,CARD,CASD,CAED,QAASd,CAAAA,CAAT,CAAyBN,CAAzB,CAA6BiC,CAA7B,CAAkC,CAChCvB,CAAiB,CAACV,CAAD,CAAKiC,CAAG,CAACd,MAAT,CAClB,CACF,CApED","sourcesContent":["// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: https://codemirror.net/LICENSE\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"qtype_proforma/codemirror\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"qtype_proforma/codemirror\"], mod);\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n  \"use strict\";\n  var WRAP_CLASS = \"CodeMirror-activeline\";\n  var BACK_CLASS = \"CodeMirror-activeline-background\";\n  var GUTT_CLASS = \"CodeMirror-activeline-gutter\";\n\n  CodeMirror.defineOption(\"styleActiveLine\", false, function(cm, val, old) {\n    var prev = old == CodeMirror.Init ? false : old;\n    if (val == prev) return\n    if (prev) {\n      cm.off(\"beforeSelectionChange\", selectionChange);\n      clearActiveLines(cm);\n      delete cm.state.activeLines;\n    }\n    if (val) {\n      cm.state.activeLines = [];\n      updateActiveLines(cm, cm.listSelections());\n      cm.on(\"beforeSelectionChange\", selectionChange);\n    }\n  });\n\n  function clearActiveLines(cm) {\n    for (var i = 0; i < cm.state.activeLines.length; i++) {\n      cm.removeLineClass(cm.state.activeLines[i], \"wrap\", WRAP_CLASS);\n      cm.removeLineClass(cm.state.activeLines[i], \"background\", BACK_CLASS);\n      cm.removeLineClass(cm.state.activeLines[i], \"gutter\", GUTT_CLASS);\n    }\n  }\n\n  function sameArray(a, b) {\n    if (a.length != b.length) return false;\n    for (var i = 0; i < a.length; i++)\n      if (a[i] != b[i]) return false;\n    return true;\n  }\n\n  function updateActiveLines(cm, ranges) {\n    var active = [];\n    for (var i = 0; i < ranges.length; i++) {\n      var range = ranges[i];\n      var option = cm.getOption(\"styleActiveLine\");\n      if (typeof option == \"object\" && option.nonEmpty ? range.anchor.line != range.head.line : !range.empty())\n        continue\n      var line = cm.getLineHandleVisualStart(range.head.line);\n      if (active[active.length - 1] != line) active.push(line);\n    }\n    if (sameArray(cm.state.activeLines, active)) return;\n    cm.operation(function() {\n      clearActiveLines(cm);\n      for (var i = 0; i < active.length; i++) {\n        cm.addLineClass(active[i], \"wrap\", WRAP_CLASS);\n        cm.addLineClass(active[i], \"background\", BACK_CLASS);\n        cm.addLineClass(active[i], \"gutter\", GUTT_CLASS);\n      }\n      cm.state.activeLines = active;\n    });\n  }\n\n  function selectionChange(cm, sel) {\n    updateActiveLines(cm, sel.ranges);\n  }\n});\n"],"file":"active-line.min.js"}