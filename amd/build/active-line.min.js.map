{"version":3,"file":"active-line.min.js","sources":["../src/active-line.js"],"sourcesContent":["// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: https://codemirror.net/LICENSE\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"qtype_proforma/codemirror\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"qtype_proforma/codemirror\"], mod);\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n  \"use strict\";\n  var WRAP_CLASS = \"CodeMirror-activeline\";\n  var BACK_CLASS = \"CodeMirror-activeline-background\";\n  var GUTT_CLASS = \"CodeMirror-activeline-gutter\";\n\n  CodeMirror.defineOption(\"styleActiveLine\", false, function(cm, val, old) {\n    var prev = old == CodeMirror.Init ? false : old;\n    if (val == prev) return\n    if (prev) {\n      cm.off(\"beforeSelectionChange\", selectionChange);\n      clearActiveLines(cm);\n      delete cm.state.activeLines;\n    }\n    if (val) {\n      cm.state.activeLines = [];\n      updateActiveLines(cm, cm.listSelections());\n      cm.on(\"beforeSelectionChange\", selectionChange);\n    }\n  });\n\n  function clearActiveLines(cm) {\n    for (var i = 0; i < cm.state.activeLines.length; i++) {\n      cm.removeLineClass(cm.state.activeLines[i], \"wrap\", WRAP_CLASS);\n      cm.removeLineClass(cm.state.activeLines[i], \"background\", BACK_CLASS);\n      cm.removeLineClass(cm.state.activeLines[i], \"gutter\", GUTT_CLASS);\n    }\n  }\n\n  function sameArray(a, b) {\n    if (a.length != b.length) return false;\n    for (var i = 0; i < a.length; i++)\n      if (a[i] != b[i]) return false;\n    return true;\n  }\n\n  function updateActiveLines(cm, ranges) {\n    var active = [];\n    for (var i = 0; i < ranges.length; i++) {\n      var range = ranges[i];\n      var option = cm.getOption(\"styleActiveLine\");\n      if (typeof option == \"object\" && option.nonEmpty ? range.anchor.line != range.head.line : !range.empty())\n        continue\n      var line = cm.getLineHandleVisualStart(range.head.line);\n      if (active[active.length - 1] != line) active.push(line);\n    }\n    if (sameArray(cm.state.activeLines, active)) return;\n    cm.operation(function() {\n      clearActiveLines(cm);\n      for (var i = 0; i < active.length; i++) {\n        cm.addLineClass(active[i], \"wrap\", WRAP_CLASS);\n        cm.addLineClass(active[i], \"background\", BACK_CLASS);\n        cm.addLineClass(active[i], \"gutter\", GUTT_CLASS);\n      }\n      cm.state.activeLines = active;\n    });\n  }\n\n  function selectionChange(cm, sel) {\n    updateActiveLines(cm, sel.ranges);\n  }\n});\n"],"names":["mod","CodeMirror","BACK_CLASS","clearActiveLines","cm","i","state","activeLines","length","removeLineClass","updateActiveLines","ranges","active","range","option","getOption","_typeof","nonEmpty","anchor","line","head","empty","getLineHandleVisualStart","push","a","b","sameArray","operation","addLineClass","selectionChange","sel","defineOption","val","old","prev","Init","off","listSelections","on","exports","module","require","define","amd"],"mappings":"0QAGA,IAAUA,IAAAA,IAOP,SAASC,gBAGNC,WAAa,4CAkBRC,iBAAiBC,QACnB,IAAIC,EAAI,EAAGA,EAAID,GAAGE,MAAMC,YAAYC,OAAQH,IAC/CD,GAAGK,gBAAgBL,GAAGE,MAAMC,YAAYF,GAAI,OArB/B,yBAsBbD,GAAGK,gBAAgBL,GAAGE,MAAMC,YAAYF,GAAI,aAAcH,YAC1DE,GAAGK,gBAAgBL,GAAGE,MAAMC,YAAYF,GAAI,SArB/B,yCAgCRK,kBAAkBN,GAAIO,gBACzBC,OAAS,GACJP,EAAI,EAAGA,EAAIM,OAAOH,OAAQH,IAAK,KAClCQ,MAAQF,OAAON,GACfS,OAASV,GAAGW,UAAU,sBACL,UAAjBC,QAAOF,SAAsBA,OAAOG,SAAWJ,MAAMK,OAAOC,MAAQN,MAAMO,KAAKD,KAAQN,MAAMQ,aAE7FF,KAAOf,GAAGkB,yBAAyBT,MAAMO,KAAKD,MAC9CP,OAAOA,OAAOJ,OAAS,IAAMW,MAAMP,OAAOW,KAAKJ,iBAfpCK,EAAGC,MAChBD,EAAEhB,QAAUiB,EAAEjB,OAAQ,OAAO,MAC5B,IAAIH,EAAI,EAAGA,EAAImB,EAAEhB,OAAQH,OACxBmB,EAAEnB,IAAMoB,EAAEpB,GAAI,OAAO,SACpB,GAaHqB,CAAUtB,GAAGE,MAAMC,YAAaK,SACpCR,GAAGuB,WAAU,WACXxB,iBAAiBC,QACZ,IAAIC,EAAI,EAAGA,EAAIO,OAAOJ,OAAQH,IACjCD,GAAGwB,aAAahB,OAAOP,GAAI,OAhDhB,yBAiDXD,GAAGwB,aAAahB,OAAOP,GAAI,aAAcH,YACzCE,GAAGwB,aAAahB,OAAOP,GAAI,SAhDhB,gCAkDbD,GAAGE,MAAMC,YAAcK,mBAIlBiB,gBAAgBzB,GAAI0B,KAC3BpB,kBAAkBN,GAAI0B,IAAInB,QArD5BV,WAAW8B,aAAa,mBAAmB,GAAO,SAAS3B,GAAI4B,IAAKC,SAC9DC,KAAOD,KAAOhC,WAAWkC,MAAeF,IACxCD,KAAOE,OACPA,OACF9B,GAAGgC,IAAI,wBAAyBP,iBAChC1B,iBAAiBC,WACVA,GAAGE,MAAMC,aAEdyB,MACF5B,GAAGE,MAAMC,YAAc,GACvBG,kBAAkBN,GAAIA,GAAGiC,kBACzBjC,GAAGkC,GAAG,wBAAyBT,uBAvBb,+BAAXU,4BAAAA,WAAwC,+BAAVC,2BAAAA,SACvCxC,IAAIyC,QAAQ,8BACY,mBAAVC,QAAwBA,OAAOC,IAC7CD,oCAAO,CAAC,6BAA8B1C,KAEtCA,IAAIC"}