function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}(function(a){if("object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"object"==("undefined"==typeof module?"undefined":_typeof(module)))a(require("qtype_proforma/codemirror"));else if("function"==typeof define&&define.amd)define ("qtype_proforma/closebrackets",["qtype_proforma/codemirror"],a);else a(CodeMirror)})(function(a){var j={pairs:"()[]{}''\"\"",closeBefore:")]}'\":;>",triples:"",explode:"[]{}"},k=a.Pos;a.defineOption("autoCloseBrackets",!1,function(d,e,f){if(f&&f!=a.Init){d.removeKeyMap(l);d.state.closeBrackets=null}if(e){c(b(e,"pairs"));d.state.closeBrackets=e;d.addKeyMap(l)}});function b(a,b){if("pairs"==b&&"string"==typeof a)return a;if("object"==_typeof(a)&&null!=a[b])return a[b];return j[b]}var l={Backspace:function(c){var d=e(c);if(!d||c.getOption("disableInput"))return a.Pass;for(var f=b(d,"pairs"),g=c.listSelections(),j=0;j<g.length;j++){if(!g[j].empty())return a.Pass;var l=h(c,g[j].head);if(!l||0!=f.indexOf(l)%2)return a.Pass}for(var j=g.length-1,m;0<=j;j--){m=g[j].head;c.replaceRange("",k(m.line,m.ch-1),k(m.line,m.ch+1),"+delete")}},Enter:function(c){var d=e(c),f=d&&b(d,"explode");if(!f||c.getOption("disableInput"))return a.Pass;for(var g=c.listSelections(),j=0;j<g.length;j++){if(!g[j].empty())return a.Pass;var k=h(c,g[j].head);if(!k||0!=f.indexOf(k)%2)return a.Pass}c.operation(function(){var a=c.lineSeparator()||"\n";c.replaceSelection(a+a,null);c.execCommand("goCharLeft");g=c.listSelections();for(var b=0,d;b<g.length;b++){d=g[b].head.line;c.indentLine(d,null,!0);c.indentLine(d+1,null,!0)}})}};function c(a){for(var b=0;b<a.length;b++){var c=a.charAt(b),e="'"+c+"'";if(!l[e])l[e]=d(c)}}c(j.pairs+"`");function d(a){return function(b){return g(b,a)}}function e(a){var b=a.state.closeBrackets;if(!b||b.override)return b;var c=a.getModeAt(a.getCursor());return c.closeBrackets||b}function f(b){var c=0<a.cmpPos(b.anchor,b.head);return{anchor:new k(b.anchor.line,b.anchor.ch+(c?-1:1)),head:new k(b.head.line,b.head.ch+(c?1:-1))}}function g(c,d){var g=e(c);if(!g||c.getOption("disableInput"))return a.Pass;var h=b(g,"pairs"),j=h.indexOf(d);if(-1==j)return a.Pass;for(var l=b(g,"closeBefore"),m=b(g,"triples"),n=h.charAt(j+1)==d,o=c.listSelections(),p=0==j%2,q,r=0;r<o.length;r++){var s=o[r],t=s.head,u,v=c.getRange(t,k(t.line,t.ch+1));if(p&&!s.empty()){u="surround"}else if((n||!p)&&v==d){if(n&&i(c,t))u="both";else if(0<=m.indexOf(d)&&c.getRange(t,k(t.line,t.ch+3))==d+d+d)u="skipThree";else u="skip"}else if(n&&1<t.ch&&0<=m.indexOf(d)&&c.getRange(k(t.line,t.ch-2),t)==d+d){if(2<t.ch&&/\bstring/.test(c.getTokenTypeAt(k(t.line,t.ch-2))))return a.Pass;u="addFour"}else if(n){var w=0==t.ch?" ":c.getRange(k(t.line,t.ch-1),t);if(!a.isWordChar(v)&&w!=d&&!a.isWordChar(w))u="both";else return a.Pass}else if(p&&(0===v.length||/\s/.test(v)||-1<l.indexOf(v))){u="both"}else{return a.Pass}if(!q)q=u;else if(q!=u)return a.Pass}var x=j%2?h.charAt(j-1):d,y=j%2?d:h.charAt(j+1);c.operation(function(){if("skip"==q){c.execCommand("goCharRight")}else if("skipThree"==q){for(var a=0;3>a;a++){c.execCommand("goCharRight")}}else if("surround"==q){for(var b=c.getSelections(),a=0;a<b.length;a++){b[a]=x+b[a]+y}c.replaceSelections(b,"around");b=c.listSelections().slice();for(var a=0;a<b.length;a++){b[a]=f(b[a])}c.setSelections(b)}else if("both"==q){c.replaceSelection(x+y,null);c.triggerElectric(x+y);c.execCommand("goCharLeft")}else if("addFour"==q){c.replaceSelection(x+x+x+x,"before");c.execCommand("goCharRight")}})}function h(a,b){var c=a.getRange(k(b.line,b.ch-1),k(b.line,b.ch+1));return 2==c.length?c:null}function i(a,b){var c=a.getTokenAt(k(b.line,b.ch+1));return /\bstring/.test(c.type)&&c.start==b.ch&&(0==b.ch||!/\bstring/.test(a.getTokenTypeAt(b)))}});
//# sourceMappingURL=closebrackets.min.js.map
