define("qtype_proforma/logmonitor",["exports","core/modal_factory","core/modal_events","core/str","core/config"],(function(_exports,_modal_factory,_modal_events,_str,_config){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * function for displaying server sent events.
   *
   * @package    qtype
   * @subpackage proforma
   * @copyright  2023 Ostfalia Hochschule fuer angewandte Wissenschaften
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   * @author     K.Borm <k.borm[at]ostfalia.de>
   */async function show(title,url,callbackstart,callbackdata,callbackend){let source=null,modalroot=null,closeString="close",titleString=title;function closeSse(){source.close();let dialog=document.querySelector(".modal");if(dialog){let button=dialog.querySelector(".btn-secondary");button&&(button.innerHTML=closeString),callbackstart&&function(element,button){let op=1,timer=setInterval((function(){if(op<=.1){clearInterval(timer);let timer1=setInterval((function(){button.click(),clearInterval(timer1)}),500)}else element.style.opacity=op,element.style.filter="alpha(opacity="+100*op+")",op-=.1*op}),50)}(dialog,button)}}await async function(){closeString=await(0,_str.get_string)("close","editor"),titleString=await(0,_str.get_string)(title,"qtype_proforma")}(),_modal_factory.default.create({type:_modal_factory.default.types.CANCEL,title:titleString,body:'<span><code id ="proforma-modal-message"></code></span>',large:!0}).then((function(modal){modalroot=modal.getRoot(),modal.getModal().css("min-width","50%"),modalroot.on(_modal_events.default.cancel,(function(){source.close(),source=null,modalroot.remove()})),modal.show(),async function(){source=new EventSource(url);let feedbackstarted=!1;source.onmessage=function(event){let dialog=document.querySelector("#proforma-modal-message");if(null!=dialog){let message=event.data;if(feedbackstarted||(message=message.trim()),message.startsWith("RESPONSE START####"))return feedbackstarted=!0,void callbackstart();if(message.endsWith("RESPONSE END####"))return console.log("end of response found => close connection"),callbackend(),void closeSse();if(message.endsWith("####")&&!message.startsWith("####"))return void closeSse();if(feedbackstarted)return void callbackdata(message);(message.startsWith("b'")||message.startsWith('b"'))&&(message="<b>"+message.substring(2,message.length-3)+"</b>"),dialog.innerHTML+=message+"<br>"}},source.onerror=function(event){closeSse()}}()}))}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.show=show,_exports.uploadToGrader=void 0,_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_config=_interopRequireDefault(_config);_exports.uploadToGrader=buttonid=>{const button=document.getElementById(buttonid);button?button.addEventListener("click",(function(e){const questionId=document.querySelector("input[name='id']").value;let url=_config.default.wwwroot+"/question/type/proforma/upload_sse.php";url+="?sesskey="+_config.default.sesskey+"&id="+questionId,show("uploadlog",url)})):console.error("could not find button "+buttonid)}}));

//# sourceMappingURL=logmonitor.min.js.map